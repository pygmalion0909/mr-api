<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mr.mr_api.user.repository.BadgeRepository">

  <select id="getList" resultType="com.mr.mr_api.user.entity.badge.BadgeListEnt">
    SELECT
      `sq1`.`cd`
      ,`sq1`.`name`
      ,`cod`.`name` AS `color`
    FROM
    (
      SELECT
        `cod`.`id`
        ,`cod`.`group`
        ,`cod`.`cd`
        ,`cod`.`name`
      FROM tb_code `cod`
      WHERE
        `cod`.`group` = #{badgeCd}
    )`sq1`
    LEFT JOIN tb_code `cod` ON `sq1`.`id` = `cod`.`ref_id`
    WHERE
      `cod`.`group` = #{colorCd}
  </select>

	<select id="getListOfInfo" resultType="com.mr.mr_api.user.dto.badge.BadgeInfoDto">
    SELECT
      `bad`.`id`
      ,`bad`.`store_id`
      ,`bad`.`cd`
      ,`bad`.`score`
      ,`cod`.`group`
      ,`cod`.`name`
      ,(SELECT `cod2`.name FROM tb_code `cod2` WHERE `cod`.id = `cod2`.ref_id) AS color
    FROM tb_badge `bad` 
    LEFT JOIN tb_code `cod` ON `bad`.cd = `cod`.cd
    WHERE
      `bad`.store_id = #{storeId}
	</select>

</mapper>